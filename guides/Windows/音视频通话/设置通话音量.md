本文介绍如何通过 NERoom SDK 静音或取消静音、设置通话音量。

## 前提条件

您需要先调用 `joinRoom` 方法加入 NERoom 的房间，并且此房间开启了 RTC 房间的配置，即在创建房间时，已在`NECreateRoomOptions`方法中，设置`enableRtc` 参数为 true，具体操作方法请参见 [创建房间](https://doc.yunxin.163.com/neroom/guide/jIxODg2Nzk?platform=pc)。

## 打开或关闭本地音频

### 技术原理

![muteMyAudio.png](https://yx-web-nosdn.netease.im/common/c002f3c65d008807a001b09d7e8fb4ce/muteMyAudio.png)

### 配置步骤

1. 调用 `getRoomContext` 方法获取房间上下文。

    调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。

2. 打开或关闭本地音频。

    - 调用 `muteMyAudio` 方法关闭本地音频采集。
    - 调用 `unmuteMyAudio` 方法开启本地音频采集。

### 示例代码

实现关闭本地音频：

```c++
auto context = m_pRoomKit->getRoomService()->getRoomContext(roomUuid);
if(context){
    context->getRtcController()->muteMyAudio([this](int code, const std::string& msg){
    });
} 
```

实现打开本地音频：

```c++
auto context = m_pRoomKit->getRoomService()->getRoomContext(roomUuid);
if(context){
    context->getRtcController()->unmuteMyAudio([this](int code, const std::string& msg){
    });
} 
```

## 静音本地音频采集设备

### 技术原理

![setRecordDeviceMute.png](https://yx-web-nosdn.netease.im/common/ead42e22bb24be2e31d86ec4a02a79dd/setRecordDeviceMute.png)

该接口只是将采集的麦克风声音静音，远端用户还能听到伴音。

### 实现方法

1. 调用 `getRoomContext` 方法获取房间上下文。

    调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。

2. 加入房间后，调用 `setRecordDeviceMute` 方法静音或取消静音采集的麦克风声音。

    - true：静音。
    - false：取消静音

### 示例代码

```c++
m_pRoomKit->getRoomService()->getPreviewRoomContext()->getPreviewRoomRtcController()->setRecordDeviceMute(true);
```

## <span id="设置采集音量">设置本地采集音量</span>

在 K 歌和语聊房等场景中，用户往往需要调整通话音量，您可以通过设置采集音量实现该功能。

除此之外，NERoom 也支持通过监听回调的方式获取房间内成员的音量。在一些语音连麦场景或者视频会议场景中，产品应用层常常需要获取发言者的音量，并通过 UI 进行音量展示，或者根据发言者的音量大小进行视图布局的动态调整。

### 技术原理

![setRecordDeviceMute.png](https://yx-web-nosdn.netease.im/common/baabb5c967c332a0e6eb15363b501574/setRecordDeviceMute.png)

NERoom 通过录音设备采集房间内成员的音频信号，将其录制下来以后播放给远端用户收听。

### 实现方法

1. 调用 `getRoomContext` 方法获取房间上下文。

    调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。

2. 在加入房间前或加入房间后，调用 `adjustRecordingSignalVolume` 方法设置录制声音的信号幅度，从而达到调节采集音量的目的。

    该方法通过 `volume` 参数设置录音信号的音量，取值范围为 0 ~ 400：

    - 0: 静音。
    - 100: （默认值）原始音量，即不对信号做缩放。
    - 400: 原始音量的 4 倍，即把信号放大到原始信号的 4 倍。

    ::: note note
    建议设置采集音量时使用默认值（100）或小于该值，否则可能会导致音质问题。
    :::

### 示例代码

```c++
int volume = 100;
m_pRoomKit->getRoomService()->getPreviewRoomContext()->getPreviewRoomRtcController()->adjustRecordingSignalVolume(volume);
```

## 静音或取消静音房间其他成员

::: note note
您可以在云信控制台上配置某角色是否具备静音房间其他成员的权限，只有具备该权限的角色才可以执行此操作。
:::

### 配置步骤

1. 加入房间后，调用 `getRoomContext` 方法获取房间上下文。

    调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。

2. 静音或取消静音房间其他成员。

    - 调用 `muteMemberAudio` 方法静音房间中的某个成员。
    - 调用 `unmuteMemberAudio` 方法取消静音房间中的某个成员。

    ::: note note
    一次只能传入一个成员的 uuid。
    :::

### 示例代码

静音房间其他成员的示例代码如下：

```c++
auto context = m_pRoomKit->getRoomService()->getRoomContext(roomUuid);
if(context){
    std::string userUuid = "123456";
    context->getRtcController()->muteMemberAudio(userUuid, [this](int code, const std::string& msg) {
    });
}
```

取消静音房间其他成员的示例代码如下：

```c++
auto context = m_pRoomKit->getRoomService()->getRoomContext(roomUuid);
if(context){
    std::string userUuid = "123456";
    context->getRtcController()->unmuteMemberAudio(userUuid, [this](int code, const std::string& msg) {
    });
}
```

## <span id="音频主要接口对比">调节音量的接口对比</span>

| <div style="width:190px">接口名称</div> |  <div style="width:140px">描述</div> | <div style="width:100px">适用场景</div> | 
|---|---|---|
| `muteMyAudio`、`unmuteMyAudio` | 开启或关闭本地音频采集和发送 | 适用于简单的音频开关场景。静音后，SDK 所有声音都不会播放。如果在有伴音的场景中，调用该接口会同时关闭伴音的采集和发送。 |
| `setRecordDeviceMute` | 静音音频采集设备 | 适用于麦克风采集和伴音同时开启时，只发送 **伴音** 音频的场景。 |
| `adjustRecordingSignalVolume` | 调节采集信号音量 | 适用于需要精确调整本地音频采集（包括外部输入）音量的场景，比如 **KTV**、**语聊房**。|

## API 参考

| 方法 | 功能描述 |
|:--|:--|
| [`muteMyAudio`](https://doc.yunxin.163.com/neroom/references/pc/doxygen/Latest/zh/html/classneroom_1_1_i_n_e_room_rtc_controller.html#a5f92b894e3fa7350ee749628db05c469) | 关闭本地音频采集 |
| [`unmuteMyAudio`](https://doc.yunxin.163.com/neroom/references/pc/doxygen/Latest/zh/html/classneroom_1_1_i_n_e_room_rtc_controller.html#acac824cd7ffc81650d2e123a0ad240ae) | 开启本地音频采集 |
| [`muteMemberAudio`](https://doc.yunxin.163.com/neroom/references/pc/doxygen/Latest/zh/html/classneroom_1_1_i_n_e_room_rtc_controller.html#ac853bf07dba06488c73ae08d9a85aa1d) | 静音房间中的某个成员 |
| [`unmuteMemberAudio`](https://doc.yunxin.163.com/neroom/references/pc/doxygen/Latest/zh/html/classneroom_1_1_i_n_e_room_rtc_controller.html#a52db0a08d07132642bfbed4f6068c7a7) | 取消静音房间中的某个成员 | 
| [`setRecordDeviceMute`](https://doc.yunxin.163.com/neroom/references/pc/doxygen/Latest/zh/html/classneroom_1_1_i_n_e_preview_room_rtc_controller.html#a4d0a1b7827e3766662206f8dc12e8e1f) | 静音或取消静音采集的麦克风声音 | 
| [`adjustRecordingSignalVolume`](https://doc.yunxin.163.com/neroom/references/pc/doxygen/Latest/zh/html/classneroom_1_1_i_n_e_preview_room_rtc_controller.html#abb2ed1fe64d31cc87104c5917e1744c8) | 调节采集的音量 |