
本文主要介绍如何通过 NERoom SDK 实现自定义房间信令的收发，后续用户实现实时字幕展示。

自定义房间信令的收发涉及以下两个场景。

- 给目标用户发送自定义信令。此时不会校验对应房间以及成员是否在房间，即可以给房间内/外的用户发送自定义信令。
- 给目标房间发送自定义信令。房间内的所有人都会收到自定义信令。

## 发送自定义房间信令

可以通过客户端和 [服务端 API](https://doc.yunxin.163.com/neroom/server-apis/TY1NzA1MzE?platform=server) 实现自定义房间信令的发送。

本文主要介绍如何通过客户端 API 发送自定义房间信令。

**给目标用户发送自定义信令**

调用 [`sendCustomMessage`](https://doc.yunxin.163.com/neroom/references/iOS/jazzy/Latest/zh/html/Classes/NEMessageChannelService.html#/c:@M@NERoomKit@objc(cs)NEMessageChannelService(im)sendCustomMessageWithRoomUuid:userUuid:commandId:data:crossAppAuthorization:callback:) 方法给目标用户发送自定义消息，包括房间内/房间外消息。

```objective-c
/// 给房间内的userUUid的用户发送自定义消息
///
/// 如果需要发送聊天消息请使用 NERoomChatController
/// - Parameters:
///   - roomUuid: 房间ID
///   - userUuid: 用户ID
///   - commandId: 自定义的消息类型
///   - data: 自定义消息内容
///   - crossAppAuthorization: 鉴权信息，可空。如果为空，则使用当前登录信息去鉴权
///   - callback: 回调
public func sendCustomMessage(roomUuid: String,
                            userUuid: String,
                            commandId: Int,
                            data: String,
                            crossAppAuthorization: NECrossAppAuthorization?,
                            callback: NECallback<AnyObject>? = nil)
```

**给目标房间发送自定义信令**

调用 [`sendCustomMessageToRoom`](https://doc.yunxin.163.com/neroom/references/iOS/jazzy/Latest/zh/html/Classes/NEMessageChannelService.html#/c:@M@NERoomKit@objc(cs)NEMessageChannelService(im)sendCustomMessageToRoom:commandId:data:crossAppAuthorization:callback:) 方法目标房间发送自定义信令。

```objective-c
  /// 向房间内发送自定义消息，如房间内信令
  /// - Parameters:
  ///   - roomUuid: 房间Id
  ///   - commandId: 消息类型，可用区间为 10000-19999
  ///   - data: 自定义消息内容
  ///   - crossAppAuthorization: 鉴权信息，可空。如果为空，则使用当前登录信息去鉴权
  ///   - callback: 回调
  public func sendCustomMessageToRoom(_ roomUuid: String,
                                      commandId: Int,
                                      data: String,
                                      crossAppAuthorization: NECrossAppAuthorization?,
                                      callback: NECallback<AnyObject>? = nil)
```


## 接收自定义房间信令


1. 调用如下接口添加自定义房间信令接收的监听。

    ```objective-c
    /// 添加自定义透传消息监听
    /// - Parameter listener: 监听器
    public func addMessageChannelListener(listener: NEMessageChannelListener)
    ```
2. 调用如下接口实现自定义房间信令的接收，并处理接收到的自定义房间信令。

    ```objective-c
    /// 接收消息回调
    /// - Parameter message: 消息对象
    @objc optional func onReceiveCustomMessage(message: NECustomMessage)
    ```


## 相关API文档


| 方法 | 功能描述|
|:--|:--|
|[`addMessageChannelListener`](https://doc.yunxin.163.com/neroom/references/iOS/jazzy/Latest/zh/html/Classes/NEMessageChannelService.html#/c:@M@NERoomKit@objc(cs)NEMessageChannelService(im)addMessageChannelListenerWithListener:)|添加消息事件监听。|
|[`NEMessageChannelListener`](https://doc.yunxin.163.com/neroom/references/iOS/jazzy/Latest/zh/html/Protocols/NEMessageChannelListener.html)|消息监听器
|[`onReceiveCustomMessage`](https://doc.yunxin.163.com/neroom/references/iOS/jazzy/Latest/zh/html/Protocols/NEMessageChannelListener.html#/c:@M@NERoomKit@objc(pl)NEMessageChannelListener(im)onReceiveCustomMessageWithMessage:)|接收自定义房间信令消息|
|[`sendCustomMessage`](https://doc.yunxin.163.com/neroom/references/iOS/jazzy/Latest/zh/html/Classes/NEMessageChannelService.html#/c:@M@NERoomKit@objc(cs)NEMessageChannelService(im)sendCustomMessageWithRoomUuid:userUuid:commandId:data:crossAppAuthorization:callback:)|给目标用户发送自定义消息，包括房间内/房间外消息
|[`sendCustomMessageToRoom`](https://doc.yunxin.163.com/neroom/references/iOS/jazzy/Latest/zh/html/Classes/NEMessageChannelService.html#/c:@M@NERoomKit@objc(cs)NEMessageChannelService(im)sendCustomMessageToRoom:commandId:data:crossAppAuthorization:callback:)|给目标房间发送自定义信令












