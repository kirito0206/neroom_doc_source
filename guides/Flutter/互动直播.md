
NERoom 的直播基于专业的跨平台视频编解码技术和大规模视频内容分发网络，提供稳定流畅、高可靠、高并发的直播服务，助力轻松打造企业级在线直播平台。

## 功能介绍

直播的应用场景包括：
- 娱乐直播：面向秀场、游戏等直播场景，提供直播秒开、色彩滤镜、主播观众直播连麦等功能，提高直播人气，活跃直播气氛。
- 电商直播：电商直播方案实现用户在看直播中边看边卖，支持时移商品介绍、用户互动等，实现快速变现。
- 教育直播：教育直播加密、动态 URL 防盗链等安全保障防止教学内容泄露，更有高可用服务链路保障教育直播的稳定性。
- 大型直播：提供海量 CDN 网络和强大的云端媒体处理能力，保障了直播的高并发和高可用。

## 前提条件

创建房间时，已在 `NECreateRoomOptions` 方法中，设置 `enableLive` 参数为 `true`，具体操作方法请参见 [创建房间](https://doc.yunxin.163.com/neroom/guide/Dc2Mzk5MjE?platform=flutter)。

## 配置步骤

1. 调用 `getRoomContext` 接口获取房间上下文。

    调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。

2. 开启直播。

    ```dart
    Future<NEResult<NERoomLiveInfo?>> startLive(NERoomLiveRequest request);
    ```

    - `NERoomLiveRequest` 相关参数说明如下表所示。

        名称 | 描述 |
        ---- | ---- |
        title | 直播主题 |
        password | 直播密码。如果密码为空，用户无需密码即可进入直播 |
        liveLayout | 直播布局，包括：<ul><li>1：画廊布局<br></li><li>2：聚焦布局<br></li><li>4：共享屏幕布局</ul> |
        userUuids| 推流用户的 uid 集合 |
        extensionConfig| 扩展配置，透传返回 |


    - `NERoomLiveInfo` 相关参数说明如下表所示。

        名称 | 描述 |
        ---- | ---- |
        title | 直播主题 |
        password | 直播密码。如果密码为空，用户无需密码即可进入直播 |
        liveLayout | 直播布局，包括：<ul><li>1：画廊布局<br></li><li>2：聚焦布局<br></li><li>4：共享屏幕布局</ul> |
        userUuids| 推流用户的 uid 集合 |
        extensionConfig| 扩展配置，跟 `NERoomLiveRequest` 中的扩展配置保持一致 |
        taskId| 直播任务编号 |
        pushUrl| 推流地址 |
        pullHttpUrl| HTTP 拉流地址 |
        pullRtmpUrl| RTMP 拉流地址 |
        pullHlsUrl| HLS 拉流地址 |
        pullRtsUrl| RTS 拉流地址 |
        chatRoomId| 直播聊天室房间号 |
        state| 直播状态。包括：<ul><li>init: 直播未开始<br></li><li>started: 直播已开始<br></li><li>ended: 直播已结束</li></ul>|   


3. 更新直播。

    参数说明请参见 `startLive` 中的参数说明：

    ```dart
    Future<NEResult<NERoomLiveInfo?>> updateLive(NERoomLiveRequest request);
    ```

4. 停止直播。

    ```dart
    Future<VoidResult> stopLive();
    ```

5. 获取直播信息。

    ```dart
    Future<NEResult<NERoomLiveInfo?>> getLiveInfo();
    ```

6. 当直播状态变更，会触发 `NERoomEventCallback` 协议中的 `liveStateChanged` 回调，通知直播状态变更。


## 示例代码

1. 主播端开启直播的示例代码如下：

    ```dart
    NERoomService roomService = NERoomKit.instance.roomService;
    NERoomContext? roomContext = roomService.getRoomContext(roomUuid);
    var request = NERoomLiveRequest(
        title : "start",
        liveLayout : NELiveLayout.neRoomLiveLayoutGallery,
        password : "4567890",
        userUuids : ["444", "3424", "434"],
        extensionConfig :"extensionConfig"
    );
    roomContext?.liveController.startLive(request).then((result){
      if(result.isSuccess()){
        var liveInfo = result.nonNullData;
        debugPrint('start live success:${liveInfo.toString()}');
      }else{
        debugPrint('start live error code:${result.code},msg:${result.msg}');
      }
    });
    ```

2. 更新直播示例代码如下：

    ```dart
    NERoomService roomService = NERoomKit.instance.roomService;
    NERoomContext? roomContext = roomService.getRoomContext(roomUuid);
    var request = NERoomLiveRequest(
        title : "update",
        liveLayout : NELiveLayout.neRoomLiveLayoutGallery,
        password : "4567890",
        userUuids : ["444", "3424", "434"],
        extensionConfig :"extensionConfig"
    );
    roomContext?.liveController.updateLive(request).then((result){
      if(result.isSuccess()){
        var liveInfo = result.nonNullData;
        debugPrint('update live success:${liveInfo.toString()}');
      }else{
        debugPrint('update live error code:${result.code},msg:${result.msg}');
      }
    });
    ```

3. 停止直播示例代码如下：

    ```dart
    NERoomService roomService = NERoomKit.instance.roomService;
    NERoomContext? roomContext = roomService.getRoomContext(roomUuid);
    roomContext?.liveController.stopLive().then((result){
      if(result.isSuccess()){
        debugPrint('stopLive  success');
      }else{
        debugPrint('stopLive  error code:${result.code},msg:${result.msg}');
      }
    });
    ```

4. 获取直播信息示例代码如下：

    ```dart
    NERoomService roomService = NERoomKit.instance.roomService;
    NERoomContext? roomContext = roomService.getRoomContext(roomUuid);
    roomContext?.liveController.getLiveInfo().then((result){
      if(result.isSuccess()){
        debugPrint('getLiveInfo  success');
      }else{
        debugPrint('getLiveInfo  error code:${result.code},msg:${result.msg}');
      }
    });
    ```

5. 监听直播状态变更

    ```dart
    NERoomService roomService = NERoomKit.instance.roomService;
    NERoomContext? roomContext = roomService.getRoomContext(roomUuid);
    roomContext?.addEventCallback(NERoomEventCallback(
      liveStateChanged: (state){
        debugPrint('live state:$state');
      }
    ));
    ```

## API 参考

| 方法 | 功能描述 |
|:--|:--|
| [`startLive`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomLiveController/startLive.html) | 开启直播。|
| [`stopLive`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomLiveController/stopLive.html) | 停止直播。|
| [`updateLive`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomLiveController/updateLiveStreamTask.html) | 更新直播。|
| [`getLiveInfo`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomLiveController/getLiveInfo.html) | 获取直播信息。|