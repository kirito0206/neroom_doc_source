本文主要介绍如何通过 NERoom SDK 在房间内实现聊天室消息的接收。

## 功能介绍

消息表示发送方给接收方发送的文本消息。

### 消息类型

| <div style="width:100px">类型</div> | <div style="width:100px">描述</div> |
|---|---|
| 文本消息 | 文本消息的内容是文本，可以包含超链接、emoji 表情符号等。表情消息是基于文本消息实现的。 文本消息大小限制为 5 KB。 |

### 功能原理

![消息收发.png](https://yx-web-nosdn.netease.im/common/440c608d23a1efa056c0450f3d0e8c54/消息收发.png)

**消息收发流程如下**：

1. 房间内的用户 A 发送一条消息到云信的 NERoom 服务器。
2. 服务器投递给房间内其他每一个成员。
3. 用户收到消息。

## 注意事项

- 用户只有加入聊天室后，才能接收消息。
- 本版本只支持文本消息和自定义消息，不支持图片消息、语音消息、视频消息等其他类型的消息。

## 接收文本消息

### 配置步骤

1. 调用如下接口添加消息接收的监听。

    ```dart
    void addEventCallback(NERoomEventCallback callback);
    ```

2. 在 `NERoomEventCallback` 的 `chatroomMessagesReceived` 参数中传入如下 callback。

    ```dart
    typedef ReceiveChatroomMessagesCallback = void Function(List<NERoomMessage> messages);
    ```

    名称 | 类型 | 描述
    ---- | ---- | ---- 
    message | NERoomMessage | 消息的相关信息

### 示例代码

实现消息接收的示例代码如下：

```dart
NERoomService roomService = NERoomKit.instance.roomService;
NERoomContext? roomContext = roomService.getRoomContext(roomUuid);
roomContext?.addEventCallback(NERoomEventCallback(
  chatroomMessagesReceived: (messages){
    for(var msg in messages){
      if(msg is NERoomTextMessage){
        debugPrint('text:${msg.text}');
      }
    }
  }
));
```

## 相关API文档

| 方法 | 功能描述 |
|:--|:--|
| [`chatroomMessagesReceived`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomEventCallback/chatroomMessagesReceived.html) | 接收聊天室消息。|
| [`addEventCallback`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NEPreviewRoomContext/addEventCallback.html) | 添加房间事件监听。