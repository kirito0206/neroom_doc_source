本文主要介绍如何通过 NERoom SDK 在房间内实现聊天室消息的发送。

## 功能介绍

### 消息类型

<!--以下表格内容为示例，可以在此基础上修改-->
| <div style="width:100px">类型</div> | <div style="width:100px">描述</div> |
|---|---|
| 文本消息 | 文本消息的内容是文本，可以包含超链接、emoji 表情符号等。表情消息是基于文本消息实现的。 文本消息大小限制为 5 KB。 |

### 功能原理

![消息收发.png](https://yx-web-nosdn.netease.im/common/440c608d23a1efa056c0450f3d0e8c54/消息收发.png)

**消息收发流程如下**：

1. 房间内的用户 A 发送一条消息到云信的 NERoom 服务器。
2. 服务器投递给房间内其他每一个成员。
3. 用户收到消息。

## 注意事项

- 用户只有加入聊天室后，才能发送消息。
- 本版本只支持文本消息，不支持图片消息、语音消息、视频消息等其他类型的消息。

## 给单人发送消息

### 配置步骤

1. 调用 `getRoomContext` 方法获取房间上下文。

    调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。
    
2. 调用 `sendDirectTextMessage` 接口，定向给某个人发送文本消息。相关参数说明如下表所示。

   参数 | 类型 |  描述 |
   ---- | ---- | ---- |
   userUuid | String | 消息接收方的用户 ID |
   message | String | 文本消息的内容 |

### 示例代码

实现给单人发送消息的示例代码如下：

```dart
NERoomService roomService = NERoomKit.instance.roomService;
NERoomContext? roomContext = roomService.getRoomContext(roomUuid);
String targetUserUuid="";
String message="broadcast text message";
roomContext?.chatController.sendDirectTextMessage(targetUserUuid, message).then((result){
  if(result.isSuccess()){
    debugPrint('sendDirectTextMessage success');
  }else{
    debugPrint('sendDirectTextMessage error code:${result.code},msg:${result.msg}');
  }
});
```

## 给多人发送消息

### 配置步骤

1. 调用 `getRoomContext` 方法获取房间上下文。

    调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。
    
2. 调用 `sendGroupTextMessage` 接口，给多人发送文本消息。相关参数说明如下表所示。
   
    参数 | 类型 |  描述 |
   ---- | ---- | ---- |
   userUuids | List\<String> | 消息接收方的用户 ID。 |
   message | String | 文本消息内容 |

### 示例代码

实现给多人发送消息的示例代码如下：

```dart
NERoomService roomService = NERoomKit.instance.roomService;
NERoomContext? roomContext = roomService.getRoomContext(roomUuid);
var userUids = ['uuid1','uuid2'];
var message = 'broadcast text message';
roomContext?.chatController.sendGroupTextMessage(userUids, message).then((result){
  if(result.isSuccess()){
    debugPrint('sendGroupTextMessage success');
  }else{
    debugPrint('sendGroupTextMessage error code:${result.code},msg:${result.msg}');
  }
});
```

## 发送广播消息

### 配置步骤

1. 调用 `getRoomContext` 方法获取房间上下文。

    调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。

2. 调用 `sendBroadcastTextMessage` 接口，向全员发送广播消息。相关参数说明如下表所示。

   参数 | 描述 |
   ---- | ---- |
   message | 文本消息内容 |

### 示例代码

实现发送广播消息的示例代码如下：

```dart
NERoomService roomService = NERoomKit.instance.roomService;
NERoomContext? roomContext = roomService.getRoomContext(roomUuid);
var message = 'broadcast text message';
roomContext?.chatController.sendBroadcastTextMessage(message).then((result){
  if(result.isSuccess()){
    debugPrint('sendBroadcastTextMessage success');
  }else{
    debugPrint('sendBroadcastTextMessage error code:${result.code},msg:${result.msg}');
  }
});
```

## API 参考

| 方法 | 功能描述 |
|:--|:--|
| [`getRoomContext`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomService/getRoomContext.html) | 根据 roomUuid 获取 RoomContext 实例 | 
| [`sendBroadcastTextMessage`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomChatController/sendBroadcastTextMessage.html) | 发送广播消息。|
| [`sendDirectTextMessage`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomChatController/sendDirectTextMessage.html) | 发送定向消息。|
| [`sendGroupTextMessage`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomChatController/sendGroupTextMessage.html) | 给多人发送消息。|