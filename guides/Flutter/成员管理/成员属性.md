成员属性是附加到房间特定成员上的一系列 `key-value` 键值对，`key` 为属性唯一名称，`value` 为当前属性值。

NERoom 允许开发者自定义成员属性，并在房间生命周期内对成员属性进行添加、更新、删除操作，同时还可以监听属性变更通知。

## 注意事项

- 在使用成员属性前，需要在控制台中创建对应属性，指定属性名称，并进行权限配置。
- 成员属性仅对当前房间内的目标成员有效，在当前房间生命周期结束后或成员中途离开房间，成员属性会统一被清理。

## 设置成员属性

NERoom 支持在加入房间时设置属性，或加入房间后设置和更新属性。

### 设置初始成员属性

在加入房间时，通过 `initialProperties` 参数可设置当前成员的初始属性。

```dart
Future<NEResult<NERoomContext>> joinRoom(NEJoinRoomParams params, NEJoinRoomOptions options);
```

示例代码如下：

```dart
Map<String,String> initialMyProperties = {};
String roomUuid = 'roomUuid';
String userName = 'userName';
String role = 'role';
NEJoinRoomParams params= NEJoinRoomParams(roomUuid:roomUuid,userName:userName,role: role, initialMyProperties: initialMyProperties);
NEJoinRoomOptions options =  NEJoinRoomOptions();
NERoomService roomService = NERoomKit.instance.roomService;
roomService.joinRoom(params, options).then((result){
  if(result.isSuccess()){
    debugPrint('joinRoom success');
  } else {
    debugPrint('joinRoom error code:${result.code},msg:${result.msg}');
  }
});
```

### 房间内设置属性

在加入房间后，可通过 `updateMemberProperty` 接口进行成员属性的设置和更新。

```dart
Future<VoidResult> updateMemberProperty(String userUuid, String key, String value);
```

相关参数说明如下表所示。

参数 | 描述 |
---- | ---- |
userUuid | 成员 uuid |
key | 属性名称，如果属性不存在，则设置该属性；如果属性已存在，则更新该属性 |
value | 属性值 |

示例代码如下：

```dart
String roomUuid = 'roomUuid';
var roomContext = NERoomKit.instance.roomService.getRoomContext(roomUuid);
roomContext?.updateMemberProperty('userUuid', 'key', 'value').then((result){
  if(result.isSuccess()){
    debugPrint('updateMemberProperty success');
  } else {
    debugPrint('updateMemberProperty error code:${result.code},msg:${result.msg}');
  }
});
```

## 查询成员属性

通过 `NERoomMember.properties` 可获取成员当前时刻的所有属性。

该字段返回一个Map，Map 中的每个 Entry 为一个成员属性，key 为属性名称，value 为属性值。

```dart
Map<String, String> get properties;
```

## 删除成员属性

在加入房间后，可通过 `deleteMemberProperty` 接口进行成员属性的删除。

```dart
Future<VoidResult> deleteMemberProperty(String userUuid, String key);
```

相关参数说明如下表所示。

参数 | 描述 |
---- | ---- |
userUuid | 成员uuid |
key | 待删除的属性名称 |

示例代码如下：

```dart
String roomUuid = 'roomUuid';
var roomContext = NERoomKit.instance.roomService.getRoomContext(roomUuid);
roomContext?.deleteMemberProperty('userUuid', 'key').then((result){
  if(result.isSuccess()){
    debugPrint('deleteMemberProperty success');
  } else {
    debugPrint('deleteMemberProperty error code:${result.code},msg:${result.msg}');
  }
});
```

## 监听成员属性变更

在进行属性操作之后，会触发属性变更通知，通过以下回调接口监听到成员属性变更事件：

- `NERoomEventCallback memberPropertiesChanged`: 成员属性变更回调通知
- `NERoomEventCallback memberPropertiesDeleted`: 成员属性删除回调通知

示例代码如下：

```dart
String roomUuid = 'roomUuid';
var roomContext = NERoomKit.instance.roomService.getRoomContext(roomUuid);
roomContext?.addEventCallback(NERoomEventCallback(
  memberPropertiesChanged: (member,propertiesMap){
      //todo
  },
  memberPropertiesDeleted: (member,propertiesMap){
      //todo
  }
));
```

## API 参考

| 方法 | 功能描述 |
|:--|:--|
| [`NERoomMember.properties`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomMember-class.html) | 查询成员属性 |
| [`updateMemberProperty`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomContext/updateMemberProperty.html )| 更新成员属性 |
| [`deleteMemberProperty`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomContext/deleteMemberProperty.html) | 删除成员属性 |