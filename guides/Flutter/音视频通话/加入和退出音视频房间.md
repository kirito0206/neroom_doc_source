本文介绍如何通过 NERoom SDK 加入或退出音视频房间、设置画布以及订阅远端视频流。

## 功能介绍

NERoom SDK 支持通过 `joinRtcChannel` 加入音视频房间，您可以进行实时音视频通话。

## 注意事项

1. 您需要先调用 `joinRoom` 方法加入 NERoom 的房间。

2. 加入或退出音视频房间后，房间内其他成员会收到 `memberJoinRtcChannel` 或 `memberLeaveRtcChannel` 回调。

## 加入音视频房间

### 配置步骤

1. 调用 `getRoomContext` 方法获取房间上下文。

    调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。
  
2. 调用 `joinRtcChannel` 方法加入音视频房间。

3. 调用此方法时，房间内其他成员会收到 `memberJoinRtcChannel` 回调。

### 示例代码

```dart
NERoomService roomService = NERoomKit.instance.roomService;
NERoomContext? roomContext = roomService.getRoomContext(roomUuid);
roomContext?.rtcController.joinRtcChannel().then((result){
  if(result.isSuccess()){
    debugPrint('joinRtcChannel success');
  }else{
    debugPrint('joinRtcChannel error code ${result.code},msg:${result.msg}');
  }
});
```

## 设置视频流画布

### 配置步骤

1. 调用 `getRoomContext` 方法获取房间上下文。

    调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。

2. 调用 `NERoomUserVideoView` 设置视频流主流的显示画布。

    `NERoomUserVideoView` 相关参数说明如下表所示。

      名称 | 描述 |
      ---- | ---- |
      userId | 用户 ID，必填 |
      key | widget key |
      debugName | 调试标识字符 |
      listener| 视频渲染事件监听器 |
      mirror| 是否镜像，默认值为false  |
      streamType|视频流的类型，参数包括：<ul><li>kHigh：大流<br></li><li> kLow：小流</li></ul>  |
      fitType|视频画布缩放方式，参数包括：<ul><li>contain：区域内尽可能大<br></li><li> cover：区域内尽可能小</li></ul> |
      backgroundColor| 背景颜色，默认值： Color(0xFF292933)  |
      builder|关闭本端视频时展示该 widget |

3. 调用 `NERoomUserVideoView.subStream` 设置辅流的显示画布。具体参数和 `NERoomUserVideoView`的一致。

### 主流画布示例代码

```dart
NERoomUserVideoView(
  bigUid!,
  debugName: bigViewUser.name,
  mirror: isSelf(bigUid) ? _frontCamera : false,
  streamType: NEVideoStreamType.kHigh,
);
```

### 辅流画布示例代码

```dart
NERoomUserVideoView.subStream(
  roomUid,
  debugName: bigViewUser.name,
  mirror: false,
  streamType: NEVideoStreamType.kLow,
);
```

## 订阅远端视频主流

### 配置步骤

1. 调用 `getRoomContext` 方法获取房间上下文。

    调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。

2. 调用 `subscribeRemoteVideoStream` 方法订阅远端视频主流。

    调用此方法时，您需要将 `userUuid` 设置为指定订阅的用户 ID。

### 示例代码

```dart
// 只有订阅远端视频 才能看到房间成员画面
String targetUid = 'targetUid';
NERoomService roomService = NERoomKit.instance.roomService;
NERoomContext? roomContext = roomService.getRoomContext(roomUuid);
roomContext?.rtcController.subscribeRemoteVideoStream(targetUid,NEVideoStreamType.kHigh).then((result){
  if(result.isSuccess()){
    debugPrint('subscribeRemoteVideoStream success');
  }else{
    debugPrint('subscribeRemoteVideoStream error code ${result.code},msg:${result.msg}');
  }
});
```

## 取消订阅远端视频主流

### 配置步骤

1. 调用 `getRoomContext` 方法获取房间上下文。

    调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。

2. 调用 `unsubscribeRemoteVideoStream` 方法取消订阅远端视频主流。

    调用此方法时，您需要将 `userUuid` 设置为指定订阅的用户 ID。

### 示例代码

```dart
String targetUid = 'targetUid';
NERoomService roomService = NERoomKit.instance.roomService;
NERoomContext? roomContext = roomService.getRoomContext(roomUuid);
roomContext?.rtcController.unsubscribeRemoteVideoStream(targetUid,NEVideoStreamType.kHigh).then((result){
  if(result.isSuccess()){
    debugPrint('unsubscribeRemoteVideoStream success');
  }else{
    debugPrint('unsubscribeRemoteVideoStream error code ${result.code},msg:${result.msg}');
  }
});
```

## 订阅远端视频辅流

### 配置步骤

1. 调用 `getRoomContext` 方法获取房间上下文。

    调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。

2. 调用 `subscribeRemoteSubStreamVideo` 方法订阅远端视频辅流。

    调用此方法时，您需要将 `userUuid` 设置为指定订阅的用户 ID。

### 示例代码

```dart
// 只有订阅成员的远端辅流，才能通过设置远端辅流画布看到成员的屏幕共享画面
String targetUid = 'targetUid';
NERoomService roomService = NERoomKit.instance.roomService;
NERoomContext? roomContext = roomService.getRoomContext(roomUuid);
roomContext?.rtcController.subscribeRemoteSubStreamVideo(targetUid).then((result){
  if(result.isSuccess()){
    debugPrint('subscribeRemoteSubStreamVideo success');
  }else{
    debugPrint('subscribeRemoteSubStreamVideo error code ${result.code},msg:${result.msg}');
  }
});
```

## 取消订阅远端视频辅流

### 配置步骤

1. 调用 `getRoomContext` 方法获取房间上下文。

    调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。

2. 调用 `unsubscribeRemoteVideoStream` 方法取消订阅远端视频辅流。

    调用此方法时，您需要将 `userUuid` 设置为指定订阅的用户 ID。

### 示例代码

```dart
String targetUid = 'targetUid';
NERoomService roomService = NERoomKit.instance.roomService;
NERoomContext? roomContext = roomService.getRoomContext(roomUuid);
roomContext?.rtcController.unsubscribeRemoteSubStreamVideo(targetUid).then((result){
  if(result.isSuccess()){
    debugPrint('unsubscribeRemoteSubStreamVideo success');
  }else{
    debugPrint('unsubscribeRemoteSubStreamVideo error code ${result.code},msg:${result.msg}');
  }
});
```

## 退出音视频房间

### 配置步骤

1. 调用 `getRoomContext` 方法获取房间上下文。

    调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。

2. 调用 `leaveRtcChannel` 方法退出音视频房间。

    调用此方法时，房间内其他成员会收到 `memberLeaveRtcChannel` 回调。

### 示例代码

```dart
NERoomService roomService = NERoomKit.instance.roomService;
NERoomContext? roomContext = roomService.getRoomContext(roomUuid);
roomContext?.rtcController.leaveRtcChannel().then((result){
  if(result.isSuccess()){
    debugPrint('leaveRtcChannel success');
  }else{
    debugPrint('leaveRtcChannel error code ${result.code},msg:${result.msg}');
  }
});
```

## API 参考

| 方法 | 功能描述 |
|:--|:--|
| [`getRoomContext`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomService/getRoomContext.html) | 根据 roomUuid 获取 RoomContext 实例 | 
| [`joinRoom`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomService/joinRoom.html) | 加入 NERoom 的房间 |
| [`joinRtcChannel`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomRtcController/joinRtcChannel.html) | 加入音视频房间 |
| [`NERoomUserVideoView`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomUserVideoView-class.html) | 设置本端主流画布 |
| [`subStream`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomUserVideoView/subStream.html) | 设置本端辅流画布 |
| [`subscribeRemoteVideoStream`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomRtcController/subscribeRemoteVideoStream.html) | 订阅远端视频主流 |
| [`unsubscribeRemoteVideoStream`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomRtcController/unsubscribeRemoteVideoStream.html) | 取消订阅远端视频主流 |
| [`leaveRtcChannel`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomRtcController/leaveRtcChannel.html) | 离开音视频房间 |
| [`memberJoinRtcChannel`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomEventCallback/memberJoinRtcChannel.html) | 成员进入 RTC 频道回调
| [`memberLeaveRtcChannel`](https://pub.dev/documentation/netease_roomkit/latest/netease_roomkit/NERoomEventCallback/memberLeaveRtcChannel.html) | 成员离开 RTC 频道回调
<!--未搜到
| [`subscribeRemoteSubStreamVideo`]() | 订阅远端视频辅流 |
-->