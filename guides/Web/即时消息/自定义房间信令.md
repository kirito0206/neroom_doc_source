
本文主要介绍如何通过 NERoom SDK 实现自定义房间信令的收发，后续用户实现实时字幕展示。

自定义房间信令的收发涉及以下两个场景。

- 给目标用户发送自定义信令。此时不会校验对应房间以及成员是否在房间，即可以给房间内/外的用户发送自定义信令。
- 给目标房间发送自定义信令。房间内的所有人都会收到自定义信令。

## 发送自定义房间信令

可以通过客户端和 [服务端 API](https://doc.yunxin.163.com/neroom/server-apis/TY1NzA1MzE?platform=server) 实现自定义房间信令的发送。

**给目标用户发送自定义信令**

调用 [`sendCustomMessage`](https://doc.yunxin.163.com/neroom/references/web/typedoc/Latest/zh/html/interfaces/index.NEMessageChannelService.html#sendCustomMessage) 方法给目标用户发送自定义消息，包括房间内/房间外消息。

```
/**
* 给房间内的成员发送自定义消息，可用来实现房间内信令。
* 如果需要发送聊天消息请使用[NERoomChatController]。
* @param roomUuid 房间ID
* @param userUuid 用户ID
* @param commandId 用来区分自定义的消息类型, 可用区间为 [10000-19999]
* @param data 自定义的消息内容
*/
NERoomKit.getInstance().messageChannelService.sendCustomMessage: (
roomUuid: string,
userUuid: string,
commandId: number,
data: string
) => Promise<NEResult<null>>
```

**给目标房间发送自定义信令**

调用 [`sendCustomMessageToRoom`](https://doc.yunxin.163.com/neroom/references/web/typedoc/Latest/zh/html/interfaces/index.NEMessageChannelService.html#sendCustomMessageToRoom) 方法目标房间发送自定义信令。

```
/**
* 向房间内发送自定义消息，如房间内信令。
* 如果需要发送聊天消息请使用[NERoomChatController]。
* @param roomUuid 房间ID
* @param commandId 用来区分自定义的消息类型, 可用区间为 [10000-19999]
* @param data 自定义的消息内容
*/
NERoomKit.getInstance().messageChannelService.sendCustomMessageToRoom: (
roomUuid: string,
commandId: number,
data: string
) => Promise<NEResult<null>>
```

## 接收自定义房间信令


1. 调用如下接口添加自定义房间信令接收的监听。

    ```
    /**
    * 添加自定义透传消息监听
    * @param listener 消息监听器
    */
    addMessageChannelListener: (listener: NEMessageChannelListener) => void
    ```
2. 调用如下接口实现自定义房间信令的接收，并处理接收到的自定义房间信令。

    ```
    //处理接收到的消息
    export interface NEMessageChannelListener {
        onCustomMessageReceived?: (message: NECustomMessage) => void
    }
    ```














