本文介绍如何通过 NERoom SDK 加入或退出音视频房间。

## 功能介绍

NERoom SDK 支持通过 [joinRtcChannel](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#joinRtcChannel) 加入音视频房间，您可以进行实时音视频通话。

## 注意事项

1. 您需要先调用 [joinRoom](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomService.html#joinRoom) 方法加入 NERoom 的房间，并且此房间开启了 RTC 房间的配置，即在创建房间时，已在`NECreateRoomOptions`方法中，设置`enableRtc` 参数为 true，具体操作方法请参见 [创建房间](https://doc.yunxin.163.com/neroom/guide/TU4NDAxMTQ?platform=web)。
2. 加入或退出房间后，房间内其他成员会收到 [onMemberJoinRtcChannel](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomListener.html#onMemberJoinRtcChannel) 或 [onMemberLeaveRtcChannel](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomListener.html#onMemberLeaveRtcChannel) 回调。

## 加入音视频房间

### 配置步骤

1. 调用 [getRoomContext](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomService.html#getRoomContext) 方法获取房间上下文。调用此方法时，您需要将 roomUuid 设置为您所加入房间的 ID。
2. 调用 [joinRtcChannel](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#joinRtcChannel) 方法加入音视频房间。

### 示例代码

```
/**
 * 获取房间上下文NERoomContext
 * @param roomUuid 房间ID
 */
const NERoomContext = NERoomService.getRoomContext(roomUuid)

NERoomContext.rtcController.joinRtcChannel().then(res => {
    console.log(res, 'joinRtcChannel success')
}).catch(err => {
    console.error(res, 'joinRtcChannel fail')
})

```

## 设置本端主流画布

### 配置步骤

1. 调用 [getRoomContext](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomService.html#getRoomContext) 方法获取房间上下文。调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。
2. 调用 [setupLocalVideoCanvas](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#setupLocalVideoCanvas) 方法设置本端主流画布。

### 示例代码

```
/**
 * 获取房间上下文NERoomContext
 * @param roomUuid 房间ID
 */
const NERoomContext = NERoomService.getRoomContext(roomUuid)
const element = document.querySelector(".myVideo");

try {
    NERoomContext.rtcController.setupLocalVideoCanvas(element)
} catch (error) {
    console.error(error)
}
```


## 设置远端主流画布

### 配置步骤

1. 调用 [getRoomContext](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomService.html#getRoomContext) 方法获取房间上下文。调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。
2. 调用 [setupRemoteVideoCanvas](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#setupRemoteVideoCanvas) 方法设置远端主流画布。调用此方法时，您需要将 `userUuid` 设置为指定订阅的用户 ID。

### 示例代码

```
/**
 * 获取房间上下文NERoomContext
 * @param roomUuid 房间ID
 */
const NERoomContext = NERoomService.getRoomContext(roomUuid)
const element = document.querySelector(`.${member.uuid}`) || `.${member.uuid}`;

try {
    NERoomContext.rtcController.setupRemoteVideoCanvas(element, member.uuid)
} catch (error) {
    console.error(error)
}
```

## 设置远端辅流画布

### 配置步骤

1. 调用 [getRoomContext](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomService.html#getRoomContext) 方法获取房间上下文。调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。
2. 调用 [setupRemoteSubVideoCanvas](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#setupRemoteSubVideoCanvas) 方法设置远端辅流画布。调用此方法时，您需要将 `userUuid` 设置为指定订阅的用户 ID。

### 示例代码

```
/**
 * 获取房间上下文NERoomContext
 * @param roomUuid 房间ID
 */
const NERoomContext = NERoomService.getRoomContext(roomUuid)
const element = document.querySelector(`.${member.uuid}`) || `.${member.uuid}`;

try {
    NERoomContext.rtcController.setupRemoteSubVideoCanvas(element, member.uuid)
} catch (error) {
    console.error(error)
}
```

## 订阅远端视频主流

### 配置步骤

1. 调用 [getRoomContext](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomService.html#getRoomContext) 方法获取房间上下文。调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。
2. 调用 [subscribeRemoteVideoStream](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#subscribeRemoteVideoStream) 方法订阅远端视频主流。


    参数 | 类型 | 说明
    ---- | -------------- | ---------
    `userUuid` | string | 待订阅视频流的远端用户的 ID。
    `subscribe` | boolean |设置为 `true`，开启订阅该远端用户的视频流。|

### 示例代码

```
/**
 * 获取房间上下文NERoomContext
 * @param roomUuid 房间ID
 */
const NERoomContext = NERoomService.getRoomContext(roomUuid)

try {
    NERoomContext.rtcController.subscribeRemoteVideoStream(member.uuid)
} catch (error) {
    console.error(error)
}
```

## 取消订阅远端视频主流

### 配置步骤

1. 调用 [getRoomContext](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomService.html#getRoomContext) 方法获取房间上下文。调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。
2. 调用 [unsubscribeRemoteVideoStream](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#unsubscribeRemoteVideoStream) 方法取消订阅远端视频主流。调用此方法时，您需要将 `userUuid` 设置为待取消订阅的用户 ID。

### 示例代码

```
/**
 * 获取房间上下文NERoomContext
 * @param roomUuid 房间ID
 */
const NERoomContext = NERoomService.getRoomContext(roomUuid)

try {
    NERoomContext.rtcController.unSubscribeRemoteVideo(member.uuid)
} catch (error) {
    console.error(error)
}
```






## 订阅远端视频辅流

### 配置步骤

1. 调用 [getRoomContext](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomService.html#getRoomContext) 方法获取房间上下文。调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。
2. 调用 [subscribeRemoteVideoSubStream](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#subscribeRemoteVideoSubStream) 方法订阅远端视频辅流。调用此方法时，您需要将 `userUuid` 设置为指定订阅的用户 ID，并将 `subscribe` 参数设置为 true 订阅该远端用户的视频辅流。


    参数 | 类型 | 说明
    ---- | -------------- | ---------
    `userUuid` | string | 待订阅视频辅流的远端用户的 ID。
    `subscribe` | boolean |<ul><li>true：开启订阅该远端用户的视频辅流。<li>false：关闭订阅该远端用户的视频辅流。|

### 示例代码

```
/**
 * 获取房间上下文NERoomContext
 * @param roomUuid 房间ID
 */
const NERoomContext = NERoomService.getRoomContext(roomUuid)

try {
    NERoomContext.rtcController.subscribeRemoteVideoSubStream(member.uuid, true)
} catch (error) {
    console.error(error)
}
```

## 取消订阅远端视频辅流

### 配置步骤

1. 调用 [getRoomContext](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomService.html#getRoomContext) 方法获取房间上下文。调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。
2. 调用 [unsubscribeRemoteVideoSubStream](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#unsubscribeRemoteVideoSubStream) 方法取消订阅远端视频辅流。调用此方法时，您需要将 `userUuid` 设置为待取消订阅的用户 ID。

### 示例代码

```
/**
 * 获取房间上下文NERoomContext
 * @param roomUuid 房间ID
 */
const NERoomContext = NERoomService.getRoomContext(roomUuid)

try {
    NERoomContext.rtcController.unsubscribeRemoteVideoSubStream(member.uuid)
} catch (error) {
    console.error(error)
}
```

## 退出音视频房间

### 配置步骤

1. 调用 [getRoomContext](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomService.html#getRoomContext) 方法获取房间上下文。调用此方法时，您需要将 `roomUuid` 设置为您所加入房间的 ID。
2. 调用 [leaveRtcChannel](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#leaveRtcChannel) 方法退出音视频房间。

### 示例代码

```
/**
 * 获取房间上下文NERoomContext
 * @param roomUuid 房间ID
 */
const NERoomContext = NERoomService.getRoomContext(roomUuid)

NERoomContext.rtcController.leaveRtcChannel().then(res => {
    console.log(res, 'leaveRtcChannel success')
}).catch(err => {
    console.error(res, 'leaveRtcChannel fail')
})
```

## API 参考

| **方法** | **功能描述** |
|:--|:--|
|[joinRoom](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomService.html#joinRoom)|加入 NERoom 的房间。|
|[getRoomContext](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomService.html#getRoomContext)|获取房间上下文。|
|[joinRtcChannel](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#joinRtcChannel)|加入音视频房间。|
|[setupLocalVideoCanvas](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#setupLocalVideoCanvas)|设置本端画布。|
|[setupRemoteVideoCanvas](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#setupRemoteVideoCanvas)|设置远端画布。|
|[setupRemoteSubVideoCanvas](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#setupRemoteSubVideoCanvas)|设置远端辅流画布。|
|[subscribeRemoteVideoStream](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#subscribeRemoteVideoStream)|订阅远端视频主流。|
|[unSubscribeRemoteVideoStream](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#unsubscribeRemoteVideoStream)|取消订阅远端视频主流。|
|[subscribeRemoteVideoSubStream](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#subscribeRemoteVideoSubStream)|订阅远端视频辅流。|
|[unsubscribeRemoteVideoSubStream](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#unsubscribeRemoteVideoSubStream)|取消订阅远端视频辅流。|
|[leaveRtcChannel](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomRtcController.html#leaveRtcChannel)|离开音视频房间。|
|[onMemberJoinRtcChannel](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomListener.html#onMemberJoinRtcChannel)|成员加入音视频房间回调。|
|[onMemberLeaveRtcChannel](https://doc.yunxin.163.com/neroom/api-refer/web/typedoc/Latest/zh/html/interfaces/index.NERoomListener.html#onMemberLeaveRtcChannel)|成员加入音视频房间回调。|
